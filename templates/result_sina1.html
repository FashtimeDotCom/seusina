<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>单条微博数据爬取结果</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/style.css">
    <script type="text/javascript" src="/static/js/echarts.min.js"> </script>
</head>
<body>
<div id="main" style="width: 900px;height:600px;"></div>
</body>

<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script>
    processtime=function (val) {
                      var date = new Date(parseInt(val) * 1000);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
                      obj = {
                          year: date.getFullYear(),
                          mon: date.getMonth() + 1,
                          day: date.getDate(),
                          hour: date.getHours(),
                          min: date.getMinutes(),
                          sec: date.getSeconds(),
                      };
                      return obj;
                  };
    var myChart = echarts.init(document.getElementById('main'));
// 指定图表的配置项和数据
    var hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];
    data=[]
    option = {
            title: {
                text: '微博评论统计图',
            },
//            legend: {
//                data: ['Punch Card'],
//                left: 'left'
//            },
            polar: {},
            tooltip: {
                formatter: function (params) {
                    return "评论时间:"+params.value[0]+","+params.value[1];
                }
            },
            toolbox: {
                show: true,
                feature: {
                    dataView:{
                        show:true
                    },
                    restore:{
                        show:true
                    },
                    dataZoom:{
                        show:true
                    },
                    saveAsImage: {
                        show: true
                    },
                }
            },
            angleAxis: {
                type: 'value',
                data: hours,
                boundaryGap: false,
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: '#999',
                        type: 'dashed'
                    }
                },
                axisLine: {
                    show: false
                }
            },
            radiusAxis: {
                type: 'value',
//                data: days,
                axisLine: {
                    show: false
                },
                axisLabel: {
                    show: false
                }
            },
            series: [{
                name: '评论',
                type: 'scatter',
                coordinateSystem: 'polar',
                symbolSize: function (val) {
                    return val[2] * 2;
                },
                data: data,
                animationDelay: function (idx) {
                    return idx * 5;
                }
            }]
        };// 使用刚指定的配置项和数据显示图表。
{#    res=['1519296825', '1519296825', '1519296825', '1519296825', '1519296825', '1519296825', '1519296825', '1519296825', '1519296825', '1519296825', '1519296887', '1519296887', '1519296887', '1519296887', '1519296887', '1519296887', '1519296887']#}
    setInterval(function(){$.ajax({
          cache: false,
          type: "POST",
          url: "/result1/",
          data: {"cookie":"{{cookie}}"},
          async: true,
          beforeSend: function (xhr, settings) {
            xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
          },
          success: function (res) {
              console.log("!!!!!!!!!!!!!!!!!")
              console.log(res)
              result = processtime(res["time"])
              console.log(result)
              data.push([parseInt(parseInt(result["year"])*365 + parseInt(result["mon"])*30 + result["day"]), parseInt(result["hour"]) + parseInt(result["min"] / 60), 2])
              option.series.data = data
              console.log(data)
              myChart.setOption(option);
              },
          error:function(error) {
              alert('ajax 请求失败！')
      },})},1000)

</script>
</html>