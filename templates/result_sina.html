<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人微博数据爬取结果</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/style.css">
    <script type="text/javascript" src="/static/js/echarts.min.js"> </script>
</head>
<body>
     <div id="main" style="width: 900px;height:600px;"></div>
</body>

<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script>
     var myChart = echarts.init(document.getElementById('main'));
// 指定图表的配置项和数据
    var option = {
        title: {
            text: '个人微博趋势'
        },
        toolbox: {
            show: true,
            feature: {
                saveAsImage: {
                    show: true
                }
            }
        },
        legend: {
            data: ['点赞数','评论数','转发数']
        },
        xAxis: {
            data: []
        },
        yAxis: {},
        series: [{
            name: '点赞数',
            type: 'line',
            data: []
        }, {
            name: '评论数',
            type: 'line',
            data: []
        },{
            name: '转发数',
            type: 'line',
            data: []
        }]
    };

    setInterval(function(){$.ajax({
          cache: false,
          type: "POST",
          url: "/result/",
          data: {"cookie":"{{cookie}}"},
          async: true,
          beforeSend: function (xhr, settings) {
            xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
          },
          success: function (res) {
              console.log(res)

              option.xAxis.data.push(parseInt(res["time"]));
              option.series[0].data.push(parseInt(res["likenum"]));
              option.series[1].data.push(parseInt(res["commentnum"]));
              option.series[2].data.push(parseInt(res["repeatnum"]));

             console.log(option)
              myChart.setOption(option);

          },
          error:function(error) {
              alert('ajax 请求失败！')

      },})},500)

</script>
</html>